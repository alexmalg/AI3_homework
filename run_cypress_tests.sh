# ============================================================================
# –°–∫—Ä–∏–ø—Ç –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ –¥–ª—è Cypress UI —Ç–µ—Å—Ç–æ–≤
# ============================================================================
#
# –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫ Cypress —Ç–µ—Å—Ç–æ–≤ –≤ Codespaces.
#
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
#   bash run_cypress_tests.sh          # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ headless —Ä–µ–∂–∏–º–µ
#   bash run_cypress_tests.sh --open   # –û—Ç–∫—Ä—ã—Ç—å Cypress Dashboard
#
# ============================================================================

echo "üöÄ AI Translator & Critic - Cypress UI Tests"
echo "=============================================="
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Node.js
echo "‚úì –ü—Ä–æ–≤–µ—Ä–∫–∞ Node.js..."
if ! command -v node &> /dev/null; then
    echo "‚úó Node.js –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
    exit 1
fi
echo "  Node.js –≤–µ—Ä—Å–∏—è: $(node --version)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ NPM
echo "‚úì –ü—Ä–æ–≤–µ—Ä–∫–∞ NPM..."
if ! command -v npm &> /dev/null; then
    echo "‚úó NPM –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
    exit 1
fi
echo "  NPM –≤–µ—Ä—Å–∏—è: $(npm --version)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ
echo ""
echo "‚úì –ü—Ä–æ–≤–µ—Ä–∫–∞ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
if curl -s http://localhost:5000/ > /dev/null 2>&1; then
    echo "  ‚úÖ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ http://localhost:5000"
else
    echo "  ‚ö†Ô∏è  Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ http://localhost:5000"
    echo "  üí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—â–µ–Ω: python run.py"
    echo ""
fi

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
echo ""
echo "‚úì –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
if [ ! -d "node_modules" ]; then
    echo "  üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é NPM –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
    npm install --silent
    echo "  ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
else
    echo "  ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Cypress
echo ""
echo "‚úì –ü—Ä–æ–≤–µ—Ä–∫–∞ Cypress..."
if command -v npx &> /dev/null && npx cypress --version &> /dev/null; then
    echo "  Cypress –≤–µ—Ä—Å–∏—è: $(npx cypress --version)"
else
    echo "‚úó Cypress –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    exit 1
fi

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
echo ""
echo "‚úì –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤..."
echo ""

if [ "$1" = "--open" ]; then
    echo "üìñ –û—Ç–∫—Ä—ã–≤–∞—é Cypress Dashboard (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º)..."
    npm run cypress:open
else
    echo "üß™ –ó–∞–ø—É—Å–∫–∞—é —Ç–µ—Å—Ç—ã –≤ headless —Ä–µ–∂–∏–º–µ..."
    npm run cypress:run
fi

echo ""
echo "‚úÖ –ì–æ—Ç–æ–≤–æ!"