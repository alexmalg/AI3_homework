/**
 * ============================================================================
 * cypress/e2e/translator_critic.cy.js
 * ============================================================================
 *
 * UI-—Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è "AI Translator & Critic"
 *
 * –í–ê–ñ–ù–û:
 * - Flask –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π ENABLE_LLM_MOCKS=1
 * - –í—Å–µ –æ—Ç–≤–µ—Ç—ã API –º–æ–∫–∏—Ä—É—é—Ç—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –°–ï–†–í–ï–†–ê (–≤ llm_client.py)
 * - cy.intercept() –ù–ï –ù–£–ñ–ï–ù, —Ç.–∫. Flask –Ω–µ –¥–µ–ª–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
 * ============================================================================
 */

describe('AI Translator & Critic - UI Tests', () => {

  beforeEach(() => {
    cy.log('üîß –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ç–µ—Å—Ç—É');
  });

  /**
   * TEST 1: –£—Å–ø–µ—à–Ω—ã–π –ü–µ—Ä–µ–≤–æ–¥ –∏ –û—Ü–µ–Ω–∫–∞
   */
  it('–£—Å–ø–µ—à–Ω—ã–π –ü–µ—Ä–µ–≤–æ–¥ –∏ –û—Ü–µ–Ω–∫–∞ —Å –ø–æ–º–æ—â—å—é Mocked API', () => {

    cy.log('üìÑ –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ /');
    cy.visit('/');

    cy.contains('AI Translator & Critic').should('exist');

    cy.log('üìù –í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞');
    cy.get('textarea[name="text"]')
      .should('be.visible')
      .clear()
      .type('–°–æ–ª–Ω—Ü–µ —Å–≤–µ—Ç–∏—Ç.');

    cy.get('textarea[name="text"]').should('have.value', '–°–æ–ª–Ω—Ü–µ —Å–≤–µ—Ç–∏—Ç.');

    cy.log('üåç –í—ã–±–æ—Ä —è–∑—ã–∫–∞');
    cy.get('select[name="language"]')
      .should('be.visible')
      .select('english');

    cy.get('select[name="language"]').should('have.value', 'english');

    cy.log('üöÄ –ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "–ü–µ—Ä–µ–≤–µ—Å—Ç–∏"');
    cy.contains('button', '–ü–µ—Ä–µ–≤–µ—Å—Ç–∏')
      .should('be.visible')
      .click();

    // –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤–æ –≤—Ç–æ—Ä–æ–º result-block (–ø–µ—Ä–µ–≤–æ–¥) –ø–æ—è–≤–∏–ª—Å—è —Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–≤–æ–¥–∞
    cy.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞');
    cy.get('.result-block', { timeout: 10000 })
      .eq(1) // 0 - –æ—Ä–∏–≥–∏–Ω–∞–ª, 1 - –ø–µ—Ä–µ–≤–æ–¥, 2 - –æ—Ü–µ–Ω–∫–∞
      .within(() => {
        cy.get('.result-text')
          .should('contain.text', 'The sun is shining.');
      });

    // –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤ —Ç—Ä–µ—Ç—å–µ–º result-block (–æ—Ü–µ–Ω–∫–∞) –ø–æ—è–≤–∏–ª–∞—Å—å –æ—Ü–µ–Ω–∫–∞
    cy.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ü–µ–Ω–∫–∏');
    cy.get('.result-block')
      .eq(2)
      .within(() => {
        cy.get('.result-text')
          .should('contain.text', 'Rating')
          .and('contain.text', '9/10');
      });

    cy.log('üéâ –¢–µ—Å—Ç 1: —É—Å–ø–µ—à–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –∏ –æ—Ü–µ–Ω–∫–∞ ‚Äî –ø—Ä–æ–π–¥–µ–Ω.');
  });

  /**
   * TEST 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API (500 Internal Server Error)
   * 
   * –ü–†–ò–ú–ï–ß–ê–ù–ò–ï: –≠—Ç–æ—Ç —Ç–µ—Å—Ç –ù–ï –ú–û–ñ–ï–¢ —Ä–∞–±–æ—Ç–∞—Ç—å —Å ENABLE_LLM_MOCKS=1,
   * —Ç.–∫. Flask –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ –º–æ–∫–∏.
   * –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å Flask –ë–ï–ó –º–æ–∫–æ–≤.
   */
  it.skip('–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API - 500 Internal Server Error', () => {
    // –¢–µ—Å—Ç –ø—Ä–æ–ø—É—â–µ–Ω, —Ç.–∫. –º–æ–∫–∏ –Ω–µ —ç–º—É–ª–∏—Ä—É—é—Ç –æ—à–∏–±–∫–∏
    cy.log('‚ö†Ô∏è –¢–µ—Å—Ç –ø—Ä–æ–ø—É—â–µ–Ω: –º–æ–∫–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –æ—à–∏–±–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞');
  });

  /**
   * TEST 3: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã - –ø—É—Å—Ç–æ–π —Ç–µ–∫—Å—Ç
   */
  it('–í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã - –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø—É—Å—Ç–æ–π —Ç–µ–∫—Å—Ç', () => {
    cy.log('üìÑ –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ /');
    cy.visit('/');

    cy.log('üöÄ –ü–æ–ø—ã—Ç–∫–∞ –Ω–∞–∂–∞—Ç—å "–ü–µ—Ä–µ–≤–µ—Å—Ç–∏" –±–µ–∑ —Ç–µ–∫—Å—Ç–∞');
    cy.contains('button', '–ü–µ—Ä–µ–≤–µ—Å—Ç–∏')
      .should('be.visible')
      .click();

    // HTML5 –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤—Å—ë –µ—â—ë –Ω–∞ —Ç–æ–π –∂–µ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –±–µ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    cy.get('.result-block').should('not.exist');

    cy.log('‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç: –ø—É—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
  });

  /**
   * TEST 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   */
  it('–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', () => {
    cy.log('üìÑ –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ /');
    cy.visit('/');

    cy.contains('AI Translator & Critic').should('exist');
    cy.get('textarea[name="text"]').should('be.visible');
    cy.get('select[name="language"]').should('be.visible');
    cy.contains('button', '–ü–µ—Ä–µ–≤–µ—Å—Ç–∏').should('be.visible');

    cy.log('‚úÖ –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
  });
});
