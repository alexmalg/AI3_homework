# ============================================================================
# app.py - Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ "AI Translator & Critic"
# ============================================================================
# –≠—Ç–æ—Ç –º–æ–¥—É–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞:
# 1. –°–æ–∑–¥–∞–Ω–∏–µ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
# 2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ (URL endpoints)
# 3. –û–±—Ä–∞–±–æ—Ç–∫—É GET –∏ POST –∑–∞–ø—Ä–æ—Å–æ–≤
# 4. –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—é —Ä–∞–±–æ—Ç—ã –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –∏ LLM API
#
# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
# - GET / –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–æ—Ä–º—É –¥–ª—è –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞
# - POST / –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–≤–æ–¥ –∏ –æ—Ü–µ–Ω–∫—É —Ç–µ–∫—Å—Ç–∞
#
# –ù–∞—á–∏–Ω–∞—é—â–∏–º QA-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º: —ç—Ç–æ –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π
# –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ HTTP –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –±—Ä–∞—É–∑–µ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# ============================================================================



from flask import Flask, render_template, request, jsonify
from src.config import Config
from src.services.llm_client import call_llm




# ============================================================================
# –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø FLASK –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
# ============================================================================



# –°–æ–∑–¥–∞–µ–º Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
# –ü–∞—Ä–∞–º–µ—Ç—Ä __name__ –ø–æ–∑–≤–æ–ª—è–µ—Ç Flask –Ω–∞–π—Ç–∏ —à–∞–±–ª–æ–Ω—ã –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
app = Flask(__name__, template_folder="templates")



# –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ config.py
app.config.from_object(Config)



# –õ–æ–≥–∏—Ä—É–µ–º –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
print("=" * 70)
print("üöÄ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ 'AI Translator & Critic' –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...")
print("=" * 70)




# ============================================================================
# –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
# ============================================================================



def validate_translation_input(text: str, language: str) -> dict:
    """
    –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞.
    
    –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
        text (str): –¢–µ–∫—Å—Ç –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
        language (str): –í—ã–±—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫ –ø–µ—Ä–µ–≤–æ–¥–∞
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
        dict: –°–ª–æ–≤–∞—Ä—å —Å –ø–æ–ª—è–º–∏:
              - is_valid (bool): –í–∞–ª–∏–¥–Ω—ã –ª–∏ –¥–∞–Ω–Ω—ã–µ
              - error_message (str): –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ (–µ—Å–ª–∏ is_valid=False)
    
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
        1. –ß—Ç–æ —Ç–µ–∫—Å—Ç –Ω–µ –ø—É—Å—Ç–æ–π
        2. –ß—Ç–æ —Ç–µ–∫—Å—Ç –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É
        3. –ß—Ç–æ —è–∑—ã–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
    
    –ù–∞—á–∏–Ω–∞—é—â–∏–º QA-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º: —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –∑–∞—â–∏—â–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç
    –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–π—Ç–µ –µ–µ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ç–µ–∫—Å—Ç–∞.
    """
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: —Ç–µ–∫—Å—Ç –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É—Å—Ç—ã–º (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–±–µ–ª–æ–≤)
    if not text or not text.strip():
        return {
            "is_valid": False,
            "error_message": "‚ùå –û—à–∏–±–∫–∞: –¢–µ–∫—Å—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º"
        }
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: —Ç–µ–∫—Å—Ç –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É
    if len(text) > Config.MAX_TEXT_LENGTH:
        return {
            "is_valid": False,
            "error_message": f"‚ùå –û—à–∏–±–∫–∞: –¢–µ–∫—Å—Ç —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π (–º–∞–∫—Å. {Config.MAX_TEXT_LENGTH} —Å–∏–º–≤–æ–ª–æ–≤)"
        }
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: —è–∑—ã–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–ø–∏—Å–∫–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö
    if language not in Config.SUPPORTED_LANGUAGES:
        return {
            "is_valid": False,
            "error_message": f"‚ùå –û—à–∏–±–∫–∞: –Ø–∑—ã–∫ '{language}' –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è"
        }
    
    # –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã
    return {"is_valid": True, "error_message": None}




def build_translation_prompt(text: str, language: str) -> str:
    """
    –°—Ç—Ä–æ–∏—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞.
    
    –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
        text (str): –ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
        language (str): –¶–µ–ª–µ–≤–æ–π —è–∑—ã–∫
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
        str: –ü–æ–ª–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM –º–æ–¥–µ–ª–∏
    
    –ü—Ä–∏–º–µ—Ä –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞:
        "Translate the following text to English:\n\n–ü—Ä–∏–≤–µ—Ç –º–∏—Ä"
    
    –ù–∞—á–∏–Ω–∞—é—â–∏–º QA-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º: –∑–¥–µ—Å—å –º—ã —Ñ–æ—Ä–º–∏—Ä—É–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–ª—è LLM.
    –ö–∞—á–µ—Å—Ç–≤–æ –ø—Ä–æ–º–ø—Ç–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–≤–æ–¥–∞.
    """
    
    # –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —è–∑—ã–∫–∞ (English –≤–º–µ—Å—Ç–æ "english")
    language_name = Config.SUPPORTED_LANGUAGES.get(language, language)
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç —Å —á–µ—Ç–∫–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π
    prompt = f"""Translate the following text to {language_name}.
Only provide the translated text without any additional comments or explanations.



Text to translate:
{text}"""
    
    return prompt




def build_evaluation_prompt(original_text: str, translated_text: str) -> str:
    """
    –°—Ç—Ä–æ–∏—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–≤–æ–¥–∞.
    
    –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
        original_text (str): –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç
        translated_text (str): –ü–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
        str: –ü—Ä–æ–º–ø—Ç –¥–ª—è LLM-as-a-Judge –º–æ–¥–µ–ª–∏
    
    –ü—Ä–∏–º–µ—Ä –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞:
        "Evaluate the translation quality from 1 to 10 and provide reasoning.
         Original: –ü—Ä–∏–≤–µ—Ç –º–∏—Ä
         Translation: Hello world"
    
    –ù–∞—á–∏–Ω–∞—é—â–∏–º QA-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º: —ç—Ç–æ—Ç –ø—Ä–æ–º–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π
    –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–≤–æ–¥–∞. LLM –±—É–¥–µ—Ç –¥–∞–≤–∞—Ç—å –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 10.
    """
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º —á–µ—Ç–∫—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–ª—è –æ—Ü–µ–Ω–∫–∏
    prompt = f"""Evaluate the quality of the translation from 1 to 10 and provide reasoning.
Consider accuracy, fluency, and completeness.



Original text:
{original_text}



Translated text:
{translated_text}



Provide your evaluation in the following format:
Rating: [1-10]
Reasoning: [your explanation]"""
    
    return prompt




# ============================================================================
# –ú–ê–†–®–†–£–¢–´ (ENDPOINTS)
# ============================================================================



@app.route("/", methods=["GET"])
def index():
    """
    –ú–∞—Ä—à—Ä—É—Ç GET / - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
    
    –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
    1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç http://localhost:5000/
    2. Flask –∑–∞–≥—Ä—É–∂–∞–µ—Ç —à–∞–±–ª–æ–Ω index.html
    3. –ü–µ—Ä–µ–¥–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —è–∑—ã–∫–æ–≤ –≤ —à–∞–±–ª–æ–Ω
    4. –ë—Ä–∞—É–∑–µ—Ä –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ñ–æ—Ä–º—É –¥–ª—è –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
        HTML —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Ñ–æ—Ä–º–æ–π –¥–ª—è –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ –∏ –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞
    
    –ù–∞—á–∏–Ω–∞—é—â–∏–º QA-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º: —ç—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ GET –∑–∞–ø—Ä–æ—Å–∞.
    –û–Ω –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É.
    """
    
    # –õ–æ–≥–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å
    print(f"üì® GET –∑–∞–ø—Ä–æ—Å –Ω–∞ {request.path}")
    
    # –†–µ–Ω–¥–µ—Ä–∏–º HTML —à–∞–±–ª–æ–Ω –∏ –ø–µ—Ä–µ–¥–∞–µ–º –≤ –Ω–µ–≥–æ –¥–∞–Ω–Ω—ã–µ
    # render_template() - —Ñ—É–Ω–∫—Ü–∏—è Flask –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ HTML —Ñ–∞–π–ª–æ–≤
    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ –≤ —à–∞–±–ª–æ–Ω:
    # - languages: —Å–ª–æ–≤–∞—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —è–∑—ã–∫–æ–≤ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è <select>
    return render_template(
        "index.html",
        languages=Config.SUPPORTED_LANGUAGES
    )




@app.route("/", methods=["POST"])
def process_translation():
    """
    –ú–∞—Ä—à—Ä—É—Ç POST / - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ –∏ –æ—Ü–µ–Ω–∫–∏ —Ç–µ–∫—Å—Ç–∞.
    
    –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:
    1. –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏ —è–∑—ã–∫ –∏–∑ HTML —Ñ–æ—Ä–º—ã
    2. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    3. –í—ã–∑—ã–≤–∞–µ—Ç LLM –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞
    4. –í—ã–∑—ã–≤–∞–µ—Ç LLM –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–≤–æ–¥–∞
    5. –†–µ–Ω–¥–µ—Ä–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
    
    –ü—Ä–æ—Ü–µ—Å—Å (–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π):
    - –®–∞–≥ 1: call_llm —Å –º–æ–¥–µ–ª—å—é Qwen –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
    - –®–∞–≥ 2: call_llm —Å –º–æ–¥–µ–ª—å—é Claude –¥–ª—è –æ—Ü–µ–Ω–∫–∏
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
        HTML —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª–æ–º, –ø–µ—Ä–µ–≤–æ–¥–æ–º –∏ –æ—Ü–µ–Ω–∫–æ–π –∫–∞—á–µ—Å—Ç–≤–∞
    
    –ù–∞—á–∏–Ω–∞—é—â–∏–º QA-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º: —ç—Ç–æ "—Å–µ—Ä–¥—Ü–µ" –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    –ó–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤—Å—è –º–∞–≥–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞ –∏ —Ä–∞–±–æ—Ç—ã —Å API.
    """
    
    # ====================================================================
    # –®–ê–ì 0: –õ–æ–≥–∏—Ä—É–µ–º –Ω–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
    # ====================================================================
    print("\n" + "=" * 70)
    print(f"üì® POST –∑–∞–ø—Ä–æ—Å –Ω–∞ {request.path}")
    print("=" * 70)
    
    # ====================================================================
    # –®–ê–ì 1: –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ HTML —Ñ–æ—Ä–º—ã
    # ====================================================================
    # request.form - –æ–±—ä–µ–∫—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ HTML <form>
    # 'text' –∏ 'language' - —ç—Ç–æ name –∞—Ç—Ä–∏–±—É—Ç—ã –∏–∑ <textarea> –∏ <select>
    
    original_text = request.form.get("text", "").strip()
    target_language = request.form.get("language", "")
    
    print(f"‚úèÔ∏è  –ü–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç: {original_text[:100]}...")
    print(f"üåç –¶–µ–ª–µ–≤–æ–π —è–∑—ã–∫: {target_language}")
    
    # ====================================================================
    # –®–ê–ì 2: –í–∞–ª–∏–¥–∏—Ä—É–µ–º –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    # ====================================================================
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–µ–∫—Å—Ç –Ω–µ –ø—É—Å—Ç–æ–π, –Ω–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π, –∏ —è–∑—ã–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
    
    validation_result = validate_translation_input(original_text, target_language)
    
    if not validation_result["is_valid"]:
        # –ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        print(f"‚ö†Ô∏è  {validation_result['error_message']}")
        
        return render_template(
            "index.html",
            languages=Config.SUPPORTED_LANGUAGES,
            original_text=original_text,
            error_message=validation_result["error_message"]
        )
    
    # ====================================================================
    # –®–ê–ì 3: –í—ã–∑—ã–≤–∞–µ–º LLM –¥–ª—è –ü–ï–†–ï–í–û–î–ê —Ç–µ–∫—Å—Ç–∞
    # ====================================================================
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–¥–µ–ª—å Qwen –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
    # –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ API
    
    print(f"\nüîÑ –ù–∞—á–∏–Ω–∞–µ–º –ø–µ—Ä–µ–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞...")
    print(f"   –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–¥–µ–ª—å: {Config.TRANSLATION_MODEL}")
    
    translation_prompt = build_translation_prompt(original_text, target_language)
    translated_text = call_llm(
        model_name=Config.TRANSLATION_MODEL,
        prompt=translation_prompt
    )
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å–ø–µ—à–Ω–æ –ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω –ø–µ—Ä–µ–≤–æ–¥
    if not translated_text:
        # –ï—Å–ª–∏ –ø–µ—Ä–µ–≤–æ–¥ –Ω–µ —É–¥–∞–ª—Å—è, –≤—ã–≤–æ–¥–∏–º –æ—à–∏–±–∫—É
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ —Ç–µ–∫—Å—Ç–∞")
        
        error_msg = "‚ùå –û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."
        
        return render_template(
            "index.html",
            languages=Config.SUPPORTED_LANGUAGES,
            original_text=original_text,
            error_message=error_msg
        )
    
    print(f"‚úÖ –ü–µ—Ä–µ–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ")
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {translated_text[:100]}...")
    
    # ====================================================================
    # –®–ê–ì 4: –í—ã–∑—ã–≤–∞–µ–º LLM –¥–ª—è –û–¶–ï–ù–ö–ò –∫–∞—á–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–≤–æ–¥–∞
    # ====================================================================
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–¥–µ–ª—å Claude –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∞
    # –≠—Ç–∞ –º–æ–¥–µ–ª—å - "—Å—É–¥—å—è", –∫–æ—Ç–æ—Ä–∞—è –æ—Ü–µ–Ω–∏—Ç –∫–∞—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–≤–æ–¥–∞ –æ—Ç 1 –¥–æ 10
    
    print(f"\n‚≠ê –û—Ü–µ–Ω–∏–≤–∞–µ–º –∫–∞—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–≤–æ–¥–∞...")
    print(f"   –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–¥–µ–ª—å: {Config.EVALUATION_MODEL}")
    
    evaluation_prompt = build_evaluation_prompt(original_text, translated_text)
    evaluation_result = call_llm(
        model_name=Config.EVALUATION_MODEL,
        prompt=evaluation_prompt
    )
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å–ø–µ—à–Ω–∞ –ª–∏ –æ—Ü–µ–Ω–∫–∞
    if not evaluation_result:
        # –ï—Å–ª–∏ –æ—Ü–µ–Ω–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        print(f"‚ö†Ô∏è  –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ü–µ–Ω–∫–µ —Ç–µ–∫—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é")
        evaluation_result = "–û—Ü–µ–Ω–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–æ—à–∏–±–∫–∞ API)"
    
    print(f"‚úÖ –û—Ü–µ–Ω–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ")
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {evaluation_result[:100]}...")
    
    # ====================================================================
    # –®–ê–ì 5: –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    # ====================================================================
    # –†–µ–Ω–¥–µ—Ä–∏–º —à–∞–±–ª–æ–Ω –∏ –ø–µ—Ä–µ–¥–∞–µ–º –µ–º—É –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    # –ë—Ä–∞—É–∑–µ—Ä –æ—Ç–æ–±—Ä–∞–∑–∏—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª, –ø–µ—Ä–µ–≤–æ–¥ –∏ –æ—Ü–µ–Ω–∫—É –∫–∞—á–µ—Å—Ç–≤–∞
    
    print(f"\n{'=' * 70}")
    print(f"‚ú® –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!")
    print(f"{'=' * 70}\n")
    
    return render_template(
        "index.html",
        languages=Config.SUPPORTED_LANGUAGES,
        original_text=original_text,
        translated_text=translated_text,
        evaluation_result=evaluation_result,
        target_language=Config.SUPPORTED_LANGUAGES.get(target_language)
    )




# ============================================================================
# –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
# ============================================================================



if __name__ == "__main__":
    """
    –≠—Ç–æ—Ç –±–ª–æ–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ñ–∞–π–ª –∑–∞–ø—É—â–µ–Ω –Ω–∞–ø—Ä—è–º—É—é
    (–Ω–µ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –∏–∑ –¥—Ä—É–≥–æ–≥–æ –º–æ–¥—É–ª—è)
    """
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
    # - host='0.0.0.0': —Å–ª—É—à–∞–µ–º –≤—Å–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è Codespaces)
    # - port=5000: –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ—Ä—Ç 5000
    # - debug=True: —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ (–∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞)
    
    print(f"\nüåê –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:5000")
    print(f"üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:")
    print(f"   1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä")
    print(f"   2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ http://localhost:5000")
    print(f"   3. –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞")
    print(f"   4. –í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª–µ–≤–æ–π —è–∑—ã–∫")
    print(f"   5. –ù–∞–∂–º–∏—Ç–µ '–ü–µ—Ä–µ–≤–µ—Å—Ç–∏'")
    print(f"\nüí° –°–æ–≤–µ—Ç: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ API –∑–∞–ø—Ä–æ—Å–æ–≤\n")
    
    app.run(host='0.0.0.0', port=5000, debug=True)
